==========
Processing
==========

Generating the databases for SciELO website
===========================================

Directories
-----------

    .. image:: img/en/scieloweb-dir.png

The *bases-work* subdirectory hosts the sub-directories of each database during 
processing in addition to individual directories for each journal. 

The *serial* subdirectory contains the directories of all journals which in turn have 
all the original numbers used in processing (this data may be discarded after 
processing is carried out and approved). 

The *bases* subdirectory has the databases for the website.
   
    .. image:: img/en/scieloweb-bases.png

The *proc* subdirectory has the processing scripts, and other files related to the processing.


GeraPadrao.bat
--------------
It is a script which generates the databases for the SciELO website.

- INPUTS: 
    - serial folder's content:
        - databases generated by Converter from markup and body folders and were sent to the Linux server by EnviaBasesScieloPadrao.bat script of the local server.
        - scilista.lst which contains a list of journal issues to be add/replaced/deleted.
    - folders and files located in /var/www/scielo/bases-work/
    - log filename. e.g.: /var/www/scielo/proc/log/GeraPadrao.log

- OUTPUTS:
    - folders and files located in /var/www/scielo/bases-work/
    - folders and files located in /var/www/scielo/bases/
    - log file. e.g.: /var/www/scielo/proc/log/GeraPadrao.log
    
Edit GeraPadrao.bat to set parameters to generate the website's databases.

    .. code-block:: text

        ./GeraScielo.bat <serial_parent_path> <proc_parent_path> <log filename> <cria>

where

    - Parameter 1: serial_parent_path: e.g.: /var/www/scielo/
    - Parameter 2: proc_parent_path:   e.g.: /var/www/scielo/
    - Parameter 3: log filename:  e.g.: /var/www/scielo/proc/log/GeraPadrao.log
    - Parameter 4: optional parameter. Use the value cria, if you want to reset the log file, otherwise, the log file will be appended.


    .. warning:: 
        It is possible to use relative paths for parameters 1 to 3.


Examples: 

    .. code-block:: text

        ./GeraScielo.bat .. .. log/GeraPadrao.log

    .. code-block:: text

        ./GeraScielo.bat .. .. log/GeraPadrao.log cria

Execute GeraPadrao.bat

Go to /var/www/scielo/proc

Edit/check scilista.lst which contains the list of journal issues of the website.

    .. code-block:: text

       vi ../serial/scilista.lst


Execute 

    .. code-block:: text

       ./GeraPadrao.bat




Transfering databases to SciELO's servers
=========================================

Configuration
-------------

Access the processing directory

    .. code-block:: text

        #>cd /var/www/scielo/proc 

Copy the FTP account configuration file.

    .. code-block:: text

        #var/www/scielo/proc$> cp transf/Envia2MedlineLogOn-exemplo.txt transf/Envia2MedlineLogOn.txt

Edit the FTP account configuration file

    .. code-block:: text

        #var/www/scielo/proc> vi transf/Envia2MedlineLogOn.txt

Change the FTP parameters, from:

    .. code-block:: text

        open ftp.scielo.br
        user user_id user_passwd

to:

    .. code-block:: text

        open ftp.scielo.br
        user <scielo.code> <password>

Execution
---------

    .. code-block:: text

        #var/www/scielo/proc$>./Envia2MedlinePadrao.bat 


Notes
`````

* Ask SciELO team for the scielo.code and password to configure the ftp account.
* Configure a **cron** to run periodically the processing. (Preferable Weekly)
* The log files are:
    * /var/www/proc/log/envia2medlineFTP.log
    * /var/www/proc/log/envia2medline.log

